name: goat-regtest

services:
  engine-api-dev:
    image: goatnetwork/bridge-api-devnet:0.1.10
    container_name: bridge-api-devnet
    platform: linux/amd64
    ports:
      - "3001:3001"
    environment:
      PORT: 3001
      DATABASE_URL: "mysql://root:123456@mysql-goat:3306/engine"
      GRPC_URL: "goat-relayer-1:50051"
      OWN_NODE_PORT: 18443
      OWN_NODE_HOST: "bitcoin-regtest"
      OWN_NODE_USER_NAME: "test"
      OWN_NODE_PASS_WORD: "test"
      GRAPH_BRIDGE_URL: "http://goat-regtest-graph-node:8000/subgraphs/name/Bridge"
      UNI_SAT_URL: "http://unisat-server-proxy:3009/v5"
      UNI_SAT_TIME_OUT: 3000
      DEPOSIT_VERSION: V1
      BITCOIN_NETWORK: regtest
      GOAT_URL: http://goat-regtest-goat-node:1317
      GETH_RPC_URL: http://goat-regtest-geth-node:8545
      BRIDGE_CONTRACT_ADDRESS: 0xbc10000000000000000000000000000000000003
      MEM_POOL_URL: https://mempool.space/testnet
    healthcheck:
      test: [ "CMD", "wget", "--spider", "-q", "http://localhost:3001" ]
      interval: 10s
      timeout: 5s
      retries: 5
    depends_on:
      mysql:
        condition: service_healthy
      geth:
        condition: service_healthy
      goat:
        condition: service_healthy
    networks:
      - goat_network

  engine-dev:
    image: goatnetwork/bridge-dev:0.1.15
    container_name: bridge-dev
    platform: linux/amd64
    depends_on:
      engine-api-dev:
        condition: service_healthy
    environment:
      FETCH_BASE_URL: "http://localhost:3001/api"
    ports:
      - "3000:3000"
    networks:
      - goat_network

  unisat-server-proxy:
    image: goatnetwork/unisat-server-proxy:0.1
    container_name: unisat-server-proxy
    platform: linux/amd64
    ports:
      - "3009:3009"
    environment:
      HTTP_PORT: 3009
      BITCOIN_PORT: 18443
      BITCOIN_HOST: "bitcoin-regtest"
      BITCOIN_USERNAME: "test"
      BITCOIN_PASSWORD: "test"
    networks:
      - goat_network

  mysql:
    image: mysql:5.7
    platform: linux/amd64
    container_name: mysql-goat
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: "123456"
      MYSQL_DATABASE: "engine"
      MYSQL_USER: "engine"
      MYSQL_PASSWORD: "123456"
    ports:
      - "13306:3306"
    networks:
      - goat_network
    healthcheck:
      test: [ "CMD", "mysqladmin", "ping", "-h", "localhost" ]
      interval: 10s
      timeout: 5s
      retries: 5

networks:
  goat_network:
    external: true
